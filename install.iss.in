
[Setup]
AppName=LibUSB-Win32
AppVerName=LibUSB-Win32-@VERSION@
AppId=LibUSB-Win32
AppPublisher=LibUSB-Win32 
AppPublisherURL=http://libusb-win32.sourceforge.net/ 
AppVersion=@VERSION@
DefaultDirName={pf}\LibUSB-Win32-@VERSION@
DefaultGroupName=LibUSB-Win32
LicenseFile=installer_license.txt
Compression=lzma
SolidCompression=yes
MinVersion=4,5
PrivilegesRequired=admin

[Files]
Source: "*.sys"; DestDir: "{sys}\drivers"; Flags: uninsneveruninstall replacesameversion restartreplace
Source: "*.dll"; DestDir: "{sys}"; Flags: uninsneveruninstall replacesameversion restartreplace

Source: "@BIN_DIST_DIR@\lib\*.*"; DestDir: "{app}\lib"; Flags: recursesubdirs
Source: "@BIN_DIST_DIR@\include\*.h"; DestDir: "{app}\include"; Flags: recursesubdirs

Source: "testlibusb.exe"; DestDir: "{app}\bin";
Source: "testlibusb-win.exe"; DestDir: "{app}\bin";
Source: "libusbd-nt.exe"; DestDir: "{sys}"; Flags: replacesameversion restartreplace
Source: "libusbd-9x.exe"; DestDir: "{sys}"; Flags: replacesameversion restartreplace

Source: "@BIN_DIST_DIR@\*.*"; DestDir: "{app}"
Source: "@SRC_DIST_DIR@\*.*"; DestDir: "{app}\src"; Flags: recursesubdirs


[Icons] 
Name: "{group}\Test Program"; Filename: "{app}\bin\testlibusb-win.exe"; 
Name: "{group}\Uninstall LibUsb-Win32"; Filename: "{uninstallexe}"
Name: "{group}\GPL License"; Filename: "{app}\COPYING_GPL.txt"
Name: "{group}\LGPL License"; Filename: "{app}\COPYING_GPL.txt"


[Run]
Filename: "rundll32"; Parameters: "libusb0.dll,usb_delete_service_rundll"; StatusMsg: "Deleting old services (this may take a few seconds) ..." 
Filename: "rundll32"; Parameters: "libusb0.dll,usb_create_service_rundll"; StatusMsg: "Creating services (this may take a few seconds) ..." 
Filename: "{app}\bin\testlibusb-win"; Description: "Run test application"; Flags: postinstall

[UninstallRun]
Filename: "rundll32"; Parameters: "libusb0.dll,usb_delete_service_rundll"

[Messages]
StatusUninstalling=Uninstalling %1 (this may take a few seconds) ...